<style>

    .custom_hidden {
            display: none;
        }

    .custom_mb2 {
        margin-bottom: 8px; 
        }

    .required::after {
        content: " *";
        color: red;
    }

    .invalid-feedback {
            display: none;
        }
        input:invalid ~ .invalid-feedback,
        select:invalid ~ .invalid-feedback {
            display: block;
        }

        h5{
            color: black;}

    .form-check-input:disabled + .form-check-label {
        color: black;
        opacity: 1;
    }

    .form-check-input:disabled {
        background-color: black;
        border-color: black;
    }            

    select {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-color: white;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        padding-right: 30px;
        background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNiIgaGVpZ2h0PSIxNiIgdmlld0JveD0iMCAwIDE2IDE2Ij4KPHBhdGggZD0iTTE0LjM2NiA2LjU2N2MtLjE5OC0uMTk4LS41MTktLjE5OC0uNzE3IDBMMTAgMTAuMjgzIDYuMzUyIDYuNTY3Yy0uMTk4LS4xOTgtLjUxOS0uMTk4LS43MTcgMCAuMTk4LjE5OC4xOTguNTE5IDAgLjcxN0w5LjYyMSAxMSAxNC4zNjcgNi43MjVjLjE5OC0uMTk4LjE5OC0uNTE5IDAtLjcxNyIvPgo8L3N2Zz4=');
        background-position: right 10px center; /* Position the arrow */
        background-repeat: no-repeat;
        }

    select::-ms-expand {
        display: none; /* Hide the default arrow in Internet Explorer */
    }

    .ui-autocomplete {
        max-height: 150px;
        width: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        background-color: white;
        cursor: pointer;
        list-style-type: none;
        margin-left: 20px;
        padding: 10px;
    }

    .ui-state-active, .ui-widget-content .ui-state-active, .ui-widget-header .ui-state-active, a.ui-button:active, .ui-button:active, .ui-state-active.ui-button:hover {
        border: 1px solid darkgrey;
        background: darkgrey;
        color: white;
    }

</style>

<div class="IHBF">
    <div class="container">
        <div class="Ihbf_Intro">
            <div class="row">
                <div class="col-12 italic-container">
                    <p>
                        <em>Use this form to report occupational hazards that pose risk to <strong><u>staff</u></strong>. If you require assistance with completing this form, please contact your supervisor, manager, or local Prevention Advisor.</em>
                    </p>
                    <p>
                        <em>In accordance with Privacy Legislation this report <strong><u>must not</u></strong> contain any personal information or identifiers (e.g. name, address, room number) pertaining to a patient, client, resident, visitor, or other staff.</em>
                    </p>
                    <p>
                        <em>For additional information and instruction please visit: <a href=https://intranet.islandhealth.ca/safety/reporting/Pages/hazard-report.aspx>Occupational Hazard Reports (IslandHealth.ca)</a></em>
                    </p>
                </div>
            </div>
            <br />
        </div>
        <div  class="Ihbf_EmployeeSection_yes">
            <h5>Employee Information</h5>
            <hr />
            <div if-field="RemainAnonymous == yes" class="row custom_mb2">
                <div class="col-6">
                    <label class="form-check-label" title="Check this box if you prefer not to reveal your identity.">
                        This report has been sent anonymously
                    </label>
                </div>
            </div>
            <div if-field="RemainAnonymous != yes" id="employee-information-div">
                <div class="row">
                    <div class="col-6">
                        <label for="employee-full-name">Employee Name</label>
                        <input name="EmployeeFullName" class="form-control custom_mb2 formfield" id="employee-full-name" value="<[f.EmployeeFullName]>" disabled>
                        <label for="employee-title">Title</label>
                        <input name="EmployeeTitle" class="form-control custom_mb2 formfield" id="employee-title" value="<[f.EmployeeTitle]>" disabled>
                        <label for="employee-email">Email</label>
                        <input name="EmployeeEmail" class="form-control custom_mb2 formfield" id="employee-email" value="<[f.EmployeeEmail]>" disabled>
                        <label for="employee-dept">Cost Center</label>
                        <input name="EmployeeDept" class="form-control custom_mb2 formfield" id="employee-dept" value="<[f.EmployeeDept]>" disabled>
                    </div>
                    <div class="col-6">
                        <label for="employee-number">Employee Number</label>
                        <input name="EmployeeNumber" class="form-control custom_mb2 formfield" id="employee-number" value="<[f.EmployeeNumber]>" disabled>
                        <label for="employee-collective-agreement">Collective Agreement</label>
                        <input name="EmployeeCollectiveAgreement" class="form-control custom_mb2 formfield" id="employee-collective-agreement" value="<[f.EmployeeCollectiveAgreement]>" disabled>
                        <label for="employee-phone">Phone Number</label>
                        <input name="EmployeePhone" class="form-control custom_mb2 formfield" id="employee-phone" value="<[f.EmployeePhone]>" disabled>
                        <label for="manager-name">Manager Name</label>
                        <input name="ManagerName" class="form-control custom_mb2 formfield" id="manager-name" value="<[f.ManagerName]>" disabled>
                        <div id="proxyInputDiv">
                            <label for="proxy-full-name">Proxy by</label>
                            <input name="proxyFullName" class="form-control custom_mb2 formfield" id="proxy-full-name" value="<[f.ProxyFullName]>" disabled>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="Ihbf_LocationSection">
            <h5>Hazard Location</h5>
            <hr />
            <div class="row">
                <div class="col-6">
                    <label for="location-facility">Facility/Homesite</label>
                    <input name="LocationFacility" class="form-control custom_mb2 formfield" id="location-facility" value="<[f.LocationFacilityName]>" disabled>
                    <label for="location-geograph">Geography</label>
                    <input name="LocationGeograph" class="form-control custom_mb2 formfield" id="location-geograph" value="<[f.LocationGeographName]>" disabled>
                </div>
                <div class="col-6">
                    <label>Building</label>
                    <input name="LocationBuilding" class="form-control custom_mb2 formfield" id="location-building" value="<[f.LocationBuildingName]>" disabled>
                    <label>Program/Department</label>
                    <input name="LocationProgram" class="form-control custom_mb2 formfield" id="location-program" value="<[f.LocationProgram]>" disabled>

                </div>
            </div>
            <div class="row">
                <div class="col-12">
                    <label for="location-description">Location Description</label>
                    <input name="LocationDescription" class="form-control custom_mb2 formfield" id="location-description" value="<[f.LocationDescription]>" disabled>
                </div>
            </div>
        </div>
        <br />
        <div class="Ihbf_FormDataSection">
            <h5>Hazard Details</h5>
            <hr />
            <div class="row">
                <div class="col-6">
                    <label for="hazard-date">Date Hazard Discovered</label>
                    <input name="HazardDate" class="form-control custom_mb2 formfield" id="hazard-date" value="<[f.HazardDate]>" disabled>
                </div>
                <div class="col-6">
                    <label for="report-date">Date of Report</label>
                    <input name="ReportDate" class="form-control custom_mb2 formfield" id="report-date" value="<[f.ReportDate]>" disabled>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <!-- <label for="was-another-org">Was another organization involved?</label> -->

                    <div class="custom_mb2">
                        <!-- <input type="radio" id="was-another-org-no" name="WasAnotherOrg" value="No" checked>
                        <label for="was-another-org-no">No</label>

                        <input class="ms-2 formfield" type="radio" id="was-another-org-yes" name="WasAnotherOrg"  value="Yes">
                        <label class="custom_mb2" for="was-another-org-yes">Yes</label> -->

                        <div class="custom_mb2" id="was-another-org-name-div" style="display:block;">
                            <label for="was-another-org-name">Involved Organization Name</label>
                            <input type="text" id="was-another-org-name" name="WasOrganizationName" class="form-control formfield" value="<[f.WasOrganizationName]>" disabled />
                        </div>
                        
                        <div class="custom_mb2">
                            <div class="row" id="was-harmed-div">
                                <label>Details of Harm or Injury Incurred:</label>
                                <div class="col-4 mt-2">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input check-group-harmed formfield" id="harm-island-health-staff" name="HarmIslandHealthStaff" value="<[f.HarmIslandHealthStaff]>" disabled>
                                        <label class="form-check-label" for="harm-island-health-staff">Island Health Staff</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input check-group-harmed formfield" id="harm-medical-staff" name="HarmMedicalStaff" value="<[f.HarmMedicalStaff]>" disabled>
                                        <label class="form-check-label" for="harm-medical-staff">Medical Staff</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input check-group-harmed formfield" id="harm-agency-nurse" name="HarmAgencyNurse" value="<[f.HarmAgencyNurse]>" disabled>
                                        <label class="form-check-label" for="harm-agency-nurse">Agency Nurse</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input check-group-harmed formfield" id="harm-contractor" name="HarmContractor" value="<[f.HarmContractor]>" disabled>
                                        <label class="form-check-label" for="harm-contractor">Contractor</label>
                                    </div>
                                </div>
                                <div class="col-4 mt-2">
                                    <div class="row">
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input check-group-harmed formfield" name="HarmPatientClientResident" id="harm-patient-client-resident" value="<[f.HarmPatientClientResident]>" disabled>
                                            <label class="form-check-label" for="harm-patient-client-resident">Patient/Client/Resident</label>
                                        </div>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input check-group-harmed formfield" name="HarmVolunteer" id="harm-volunteer" value="<[f.HarmVolunteer]>" disabled>
                                            <label class="form-check-label" for="harm-volunteer">Volunteer</label>
                                        </div>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input check-group-harmed formfield" name="HarmVisitor" id="harm-visitor" value="<[f.HarmVisitor]>" disabled>
                                            <label class="form-check-label" for="harm-visitor">Visitor</label>
                                        </div>
                                        <div class="form-check">
                                            <input type="checkbox" class="form-check-input check-group-harmed formfield" name="HarmOther" id="harm-other" value="<[f.HarmOther]>" disabled>
                                            <label class="form-check-label" for="harm-other">Other</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- <div class="col-6">
                </div> -->
                <div class="row">
                    <label class="form-check-label">Details of Hazard Type: </label>
                    <div class="col-4 mt-2">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="ViolenceAggression" id="violence-aggression" value="<[f.ViolenceAggression]>" disabled>
                            <label class="form-check-label">Violence/Aggression</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="SlipTripFall" id="slip-trip-fall" value="<[f.SlipTripFall]>" disabled>
                            <label class="form-check-label">Slip/Trip/Fall</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="ErgonomicPatientHandling" id="ergonomic-patient-handling" value="<[f.ErgonomicPatientHandling]>" disabled>
                            <label class="form-check-label">Ergonomic - Patient Handling</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="ErgonomicMaterialsHandling" id="ergonomic-materials-handling" value="<[f.ErgonomicMaterialsHandling]>" disabled>
                            <label class="form-check-label">Ergonomic - Materials Handling</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="ErgonomicOffice" id="ergonomic-office" value="<[f.ErgonomicOffice]>" disabled>
                            <label class="form-check-label">Ergonomic - Office</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="PsychologicalHealthSafety" id="psychological-health-safety" value="<[f.PsychologicalHealthSafety]>" disabled>
                            <label class="form-check-label">Psychological Health & Safety</label>
                        </div>
                    </div>
                    <div class="col-4 mt-2">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="BiologicalInfectiousAgent" id="biological-infectious-agent" value="<[f.BiologicalInfectiousAgent]>" disabled>
                            <label class="form-check-label">Biological/Infectious Agent</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="HazardousCytotoxicDrugs" id="hazardous-cytototoxy-drugs" value="<[f.HazardousCytotoxicDrugs]>" disabled>
                            <label class="form-check-label">Hazardous/Cytotoxic Drugs</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="UnregulatedSubstances" id="unregulated-substances" value="<[f.UnregulatedSubstances]>" disabled>
                            <label class="form-check-label">Unregulated Substances</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="Chemical" id="chemical" value="<[f.Chemical]>" disabled>
                            <label class="form-check-label">Chemical</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="NoiseOrVibration" id="noise-or-vibration" value="<[f.NoiseOrVibration]>" disabled>
                            <label class="form-check-label">Noise or Vibration</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="AirQualityTemperature" id="air-quality-temperature" value="<[f.AirQualityTemperature]>" disabled>
                            <label class="form-check-label">Air Quality/Temperature</label>
                        </div>
                    </div>
                    <div class="col-4 mt-2">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="BuildingInfrastructure" id="building-infrastructure" value="<[f.BuildingInfrastructure]>" disabled>
                            <label class="form-check-label">Building Infrastructure</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="BrokenFaultyEquipmentOrMaterials" id="broken-faulty-equipment-or-materials" value="<[f.BrokenFaultyEquipmentOrMaterials]>" disabled>
                            <label class="form-check-label">Broken/Faulty/Equipment or Materials</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="HitCutStruckCaught" id="hitCut-struck-caught" value="<[f.HitCutStruckCaught]>" disabled>
                            <label class="form-check-label">Hit/Cut/Struck/Caught</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="PersonalProtectiveEquipment" id="personal-protective-equipment" value="<[f.PersonalProtectiveEquipment]>" disabled>
                            <label class="form-check-label">Personal Protective Equipment</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="ElectricalOrOtherenergySource" id="electrical-or-otherenergy-source" value="<[f.ElectricalOrOtherenergySource]>" disabled>
                            <label class="form-check-label">Electrical or Other energy Source</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input check-group-hazard formfield" name="HazardOther" id="hazard-other" value="<[f.HazardOther]>" disabled>
                            <label class="form-check-label">OTHER</label>
                        </div>
                    </div>

                </div>
                <div class="row mt-2">
                    <div class="col-12 custom_mb2">
                        <label for="loc-description" class="" title="Describe the hazard\unsafe behavior and its potential to cause, injury, exposure, or illness.">Description</label>
                        <input type="text" id="loc-description" name="HazardDescription" class="form-control formfield" value="<[f.HazardDescription]>" disabled />
                    </div>
                </div>
                <div class="row mt-2">
                    <div class="col-12">
                        <label title="Your ideas to address the identified hazard\unsafe behavior.">Safety Ideas </label>
                        <input type="text" id="hazard-safety-ideas" name="HazardSafetyIdeas" class="form-control formfield" value="<[f.HazardSafetyIdeas]>" disabled />
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="row custom_mb2 mt-4">
                            <label for="name-reported" title="If you choose to report anonymously, this section may be left blank.">LEADER TO WHOM THIS CONCERN WAS REPORTED</label>
                        </div>
                    </div>
                    <div class="col-6">
                        <label>Name</label>
                        <input name="ReportedLeaderName" class="form-control custom_mb2 autocomplete autocomplete-wrapper formfield" id="name-reported" value="<[f.ReportedLeaderName]>" disabled>
                    </div>
                    <div class="col-6">
                        <label for="reported-leader-date">Date Reported to Leader</label>
                        <input type="date" name="ReportedLeaderDate" id="reported-leader-date" class="form-control  custom_mb2 formfield" value="<[f.ReportedLeaderDate]>" disabled />
                    </div>
                </div>

            </div>
        </div>
        <div class="Ihbf_ManagerSection" style="display: block;">
            <br />
            <h5>Responding Leader</h5>
            <p>
                <em>
                    Use this form to document your follow-up on reported occupational hazards that pose risk to <strong><u>staff.</u></strong> If you require assistance with completing this form, please contact your supervisor, manager, or local Prevention Advisor. In accordance with Privacy Legislation this report <strong><u>must not</u></strong> contain any personal information or identifiers (e.g. name, address, room number) pertaining to a patient, client, resident, visitor, or other staff. <br> For additional information and instruction please visit: <a href=https://intranet.islandhealth.ca/safety/reporting/Pages/hazard-report.aspx target="_blank">Occupational Hazard Reports (islandhealth.ca)</a>
                </em>
            </p>
            <hr />
            <div class="">
                <div id="responsibility-controls" class="btn-group mt-2 d-flex justify-content-between " role="group" aria-label="Responsibility Controls">
                    <button type="button" id="take-ownership" class="btn btn-outline-primary w-50 m-2 " data-bs-toggle="button" aria-pressed="false" autocomplete="off">Take Ownership</button>    
                    <button type="button" id="redirect" class="btn btn-outline-secondary w-50 m-2 " data-bs-toggle="button" aria-pressed="false" autocomplete="off" >Redirect</button>   
                </div>
            </div>
            <div class="row mt-2">
                <div id="take-ownership-div" style="display: none;">
                    <label for="report-cost-centre">Report Cost Centre</label>
                    <select id="report-cost-centre" name="ReportCostCenter" class="form-control formfield" >
                        <option>Option 1</option>
                    </select>
                </div>
                <div id="redirect-div" style="display: none;">
                    <label for="delegated-manager-user-name">Search by: User Name or Department</label>
                    <input type="text" id="delegated-manager-user-name" name="DelegatedManagerUserName" class="form-control formfield autocomplete" />
                    <input type="hidden" id="delegated-manager-display-name" name="DelegatedManagerDisplayName" class="formfield" value="" />
                    <input type="hidden" id="delegated-manager-email-address" name="DelegatedManagerEmailAddress" class="formfield" value="" />
                    <input type="hidden" id="delegated-manager-department" name="DelegatedManagerDepartment" class="formfield" value="" />
                </div>
            </div>

            <div class="mt-2" id="manager-comments-div" style="display: none;">
                <div class="row">
                    <div class="col-12 custom_mb2">
                        <label for="corrective-actions">
                            <strong>CORRECTIVE ACTIONS</strong> <em><small>Describe the response(s) and corrective action(s) taken to address concern(s). Include name of person responsible and expected completion date for each corrective action listed.</small></em>
                        </label>
                        <textarea rows="5" id="corrective-actions" name="CorrectiveActions" class="form-control formfield "></textarea>
                        <div id="error-message" style="color: red;"></div>
                        <small id="feedbackHelp" class="form-text text-muted">
                            <span style="color: red;">Important Reminder:</span> This report MUST NOT contain any personal information/identifiers (e.g. names, room numbers, addresses).
                        </small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <label for="contributing-factors">
                            <strong>CONTRIBUTING FACTORS</strong><em><small> Identify factors that may have caused or contributed to the hazard/unsafe behaviour.</small></em>
                        </label>
                        <textarea rows="5" name="ContributingFactors" id="contributing-factors" class="form-control custom_mb2 formfield"></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <label for="additional-details">
                            <strong>ADDITIONAL DETAILS</strong><em><small> Add additional details pertaining to this report if applicable.</small></em>
                        </label>
                        <textarea rows="5" name="AdditionalDetails" id="additional-details" class="form-control custom_mb2 formfield"></textarea>
                    </div>
                </div>

                <div id="divIsCompleted" class="row">
                    <div>
                        <input type="checkbox" class="form-check-input formfield" name="IsCompletedCheck" id="is-completed-check">
                        <label class="form-check-label">Completed</label>
                        <input type="hidden" id="is-complete" name="IsComplete" class="formfield" value="no" />
                        <input type="hidden" id="is-approved" name="IsApproved" class="formfield" value="no" />
                    </div>
                </div>
            </div>
            
        </div>

        </div>

        <div class="Ihbf_Footer" style="display: block">
           
        <br />
    </div>
</div>
<br />
<br />

<div id="message"> here nelson....</div>

<script type="text/javascript">

    function validateForm()
    {
        console.log('validateForm');

        let isValid = false;

        if ($("#is-approved").val() === 'yes') {
            isValid = true;
            if ($('#is-completed-check').is(':checked')) {

                const textLen = $("#corrective-actions").val().trim().length;
                const minLength = 10;
                if (textLen > minLength) {
                    isValid = true;
                    $("#corrective-actions").css('border', '2px solid green');
                    $('#error-message').text('');
                } else {
                    isValid = false;
                    $("#corrective-actions").css('border', '2px solid red');
                    $('#error-message').text(`Content must be at least ${minLength} characters long.`);
                    swal.fire("Corrective Actions must be at least 10 characters long.");
                }
            };
        } else if ($("#delegated-manager-department").val().length > 10) 
        {
            isValid = true;
        }
                    

        if (isValid) {
            $("#approve").prop("disabled", false);
        }

        return isValid;
    }

    const takeOwnership = document.getElementById('take-ownership');
    const redirect = document.getElementById('redirect');

    takeOwnership.addEventListener('click', function() 
    {
        $('#take-ownership-div').css('display', 'block');
        $('#redirect-div').css('display', 'none');
        $('#manager-comments-div').css('display', 'block');
        $('#is-approved').val('yes');
    }); 

    redirect.addEventListener('click', function() 
    {
        $('#redirect-div').css('display', 'block');
        $('#take-ownership-div').css('display', 'none');
        $('#manager-comments-div').css('display', 'none');
        $('#is-approved').val('no');

    }); 

    const isCompletedCheck = document.getElementById('is-completed-check');

    isCompletedCheck.addEventListener('change', function() 
    {
        if (isCompletedCheck.checked) {
            $('#is-complete').val('yes');
            validateForm();
        } else {
            $('#is-complete').val('no');
            $("#corrective-actions").removeAttr('style');
        }
        
    }); 




    function preLoadCustomPage() 
    {
        $("#message").text("HELLO WORLD");

        $("#delegated-manager-user-name").autocomplete(
        {
            source: function (request, response) {
                $.ajax({
                    url: baseUrl + '/api/employee/SearchD3Managers',
                    dataType: "json",
                    data: {
                        dpt: null,
                        term: request.term
                    },
                    success: function (data) {
                        let dataList = data.map(item => ({
                            label: item.displayName + ' [' + item.departmentName + ']',
                            value: item.userName,
                            displayName: item.displayName,
                            email: item.email,
                            department: item.department
                        })); 
                        response(dataList);
                    }
                });
            },
            minLength: 3,
            select: function (event, ui) {
                console.log("D3 Manager selected: " + ui.item.value);
                setTimeout(() => {
                    updateDelegatedManagerHiddenData(ui.item);
                }, 100);
            }
        });

        function updateDelegatedManagerHiddenData(data) 
        {
            console.log('updateDelegatedManagerHiddenData');

            $("#is-approved").val('no');
            $("#is-complete").val('no');
            $("#report-cost-centre").val("");
            $("#delegated-manager-display-name").val(data.displayName);
            $("#delegated-manager-email-address").val(data.email);
            $("#delegated-manager-department").val(data.department);
            $("#approve").prop("disabled", false);

        }

        function fillReportCostCentres(data) 
        {
            console.log('fillReportCostCentres');

            var select = document.getElementById('report-cost-centre');
            select.innerHTML = '';

            setTimeout(() => {
                for (var i = 0; i < data.length; i++) {
                    var opt = data[i];
                    var el = document.createElement("option");
                    el.text = opt.dpT_Display;
                    el.value = opt.dpT;
                    select.appendChild(el);
                }
                select.selectedIndex = 0;
            }, 50);
        };

        function getCurrentManagerInfo(){
          
            console.log('getCurrentManagerInfo');

            let userName = "VIHA\\" + $("#managerUserName").val();
            $.get(baseUrl + "/api/employee/GetLeaderCostCenters?userName=" + userName)
                .done(function (data) 
                {
                    setTimeout(() => {
                        fillReportCostCentres(data);
                    }, 100);
                });

            
        }

        function disablePostButtons() 
        {
            console.log('disablePostButtons');
             $("#approve").prop("disabled", true);
             $("#deny").prop("disabled", true);
         }

        function updateCheckboxesBasedOnValue() 
        {
            console.log('updateCheckboxesBasedOnValue');

            var harmedCheckboxes = document.querySelectorAll('.check-group-harmed');
            harmedCheckboxes.forEach(function(checkbox) {
                if (checkbox.value.toLowerCase() === 'yes') {
                    checkbox.checked = true;
                } else if (checkbox.value.toLowerCase() === 'no') {
                    checkbox.checked = false;
                }
            });

            var hazardCheckboxes = document.querySelectorAll('.check-group-hazard');
            hazardCheckboxes.forEach(function(checkbox) {
                if (checkbox.value.toLowerCase() === 'yes') {
                    checkbox.checked = true;
                } else if (checkbox.value.toLowerCase() === 'no') {
                    checkbox.checked = false;
                }
            });
            
        }

        function onHazardFormLoad() 
        {
            updateCheckboxesBasedOnValue();
            disablePostButtons();
            getCurrentManagerInfo();
        }

        onHazardFormLoad();
    }
</script>

 
        
